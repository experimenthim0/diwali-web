<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transaction Records - Crackers Shop</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }
    .header h1 {
      font-size: 32px;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    .header p {
      font-size: 16px;
      opacity: 0.9;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
      align-items: center;
    }
    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }
    .file-input-wrapper input[type=file] {
      position: absolute;
      left: -9999px;
    }
    .file-input-label {
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: inline-block;
    }
    .file-input-label:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s;
    }
    .btn-refresh {
      background: #10b981;
      color: white;
    }
    .btn-refresh:hover {
      background: #059669;
      transform: translateY(-2px);
    }
    .btn-export {
      background: #f59e0b;
      color: white;
    }
    .btn-export:hover {
      background: #d97706;
      transform: translateY(-2px);
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    .stat-card {
      padding: 20px;
      border-radius: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-align: center;
    }
    .stat-card h3 {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .stat-card .value {
      font-size: 28px;
      font-weight: bold;
    }
    .search-box {
      width: 100%;
      padding: 12px 20px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 16px;
      margin-bottom: 20px;
      transition: border 0.3s;
    }
    .search-box:focus {
      outline: none;
      border-color: #667eea;
    }
    .table-wrapper {
      overflow-x: auto;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }
    thead {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    th {
      padding: 15px;
      text-align: left;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 12px;
      letter-spacing: 1px;
    }
    td {
      padding: 15px;
      border-bottom: 1px solid #e5e7eb;
    }
    tbody tr {
      transition: background 0.2s;
    }
    tbody tr:hover {
      background: #f9fafb;
    }
    tbody tr:last-child td {
      border-bottom: none;
    }
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    .badge-success {
      background: #d1fae5;
      color: #065f46;
    }
    .badge-warning {
      background: #fef3c7;
      color: #92400e;
    }
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #6b7280;
    }
    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    .empty-state h3 {
      font-size: 24px;
      margin-bottom: 10px;
      color: #374151;
    }
    .amount-original {
      color: #6b7280;
      text-decoration: line-through;
      font-size: 13px;
    }
    .amount-final {
      color: #059669;
      font-weight: 600;
      font-size: 16px;
    }
    .discount-badge {
      background: #fee2e2;
      color: #991b1b;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 5px;
    }
    .file-name {
      color: #667eea;
      font-weight: 600;
      margin-left: 10px;
    }
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      table {
        font-size: 14px;
      }
      th, td {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üìä Transaction Records</h1>
    <p>Crackers Shop - Payment History</p>
  </div>

  <div class="container">
    <div class="controls">
      <div class="file-input-wrapper">
        <input type="file" id="fileInput" accept=".json" onchange="loadJSON(event)">
        <label for="fileInput" class="file-input-label">
          üìÅ Load transactions.json
        </label>
      </div>
      <button class="btn btn-refresh" onclick="refreshData()">üîÑ Refresh</button>
      <button class="btn btn-export" onclick="exportToCSV()">üì• Export CSV</button>
      <span class="file-name" id="fileName"></span>
    </div>

    <div class="stats" id="stats"></div>

    <input type="text" class="search-box" id="searchBox" placeholder="üîç Search by ID, date, or amount..." onkeyup="filterTable()">

    <div class="table-wrapper">
      <table id="transactionTable">
        <thead>
          <tr>
            <th>Transaction ID</th>
            <th>Date & Time</th>
            <th>Original Amount</th>
            <th>Discount</th>
            <th>Final Amount</th>
            <th>Saved</th>
            <th>Mode</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <tr>
            <td colspan="7">
              <div class="empty-state">
                <div class="empty-state-icon">üìÑ</div>
                <h3>No transactions loaded</h3>
                <p>Please load your transactions.json file to view records</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    let transactions = [];
    let filteredTransactions = [];

    function loadJSON(event) {
      const file = event.target.files[0];
      if (!file) return;

      document.getElementById('fileName').textContent = file.name;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          transactions = JSON.parse(e.target.result);
          filteredTransactions = [...transactions];
          displayTransactions();
          updateStats();
        } catch (error) {
          alert('Error reading JSON file. Please make sure it\'s a valid transactions.json file.');
          console.error('JSON Parse Error:', error);
        }
      };
      reader.readAsText(file);
    }

    function displayTransactions() {
      const tableBody = document.getElementById('tableBody');
      
      if (filteredTransactions.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="7">
              <div class="empty-state">
                <div class="empty-state-icon">üîç</div>
                <h3>No transactions found</h3>
                <p>Try adjusting your search or load a different file</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tableBody.innerHTML = filteredTransactions.map(t => `
        <tr>
          <td style="font-family: monospace; font-size: 11px;">${t.id}</td>
          <td>${t.dateTime}</td>
          <td>
            <div class="amount-original">‚Çπ${t.originalAmount.toFixed(2)}</div>
          </td>
          <td>
            <span class="discount-badge">${t.discountPercent}% OFF</span>
          </td>
          <td>
            <div class="amount-final">‚Çπ${t.finalAmount.toFixed(2)}</div>
          </td>
          <td style="color: #059669; font-weight: 600;">‚Çπ${t.savedAmount.toFixed(2)}</td>
          <td>
            <span class="badge ${t.mode === 'working' ? 'badge-success' : 'badge-warning'}">
              ${t.mode === 'working' ? 'üíº Working' : 'üß™ Test'}
            </span>
          </td>
        </tr>
      `).join('');
    }

    function updateStats() {
      const totalTransactions = transactions.length;
      const totalRevenue = transactions.reduce((sum, t) => sum + t.finalAmount, 0);
      const totalSavings = transactions.reduce((sum, t) => sum + t.savedAmount, 0);
      const workingMode = transactions.filter(t => t.mode === 'working').length;

      document.getElementById('stats').innerHTML = `
        <div class="stat-card">
          <h3>Total Transactions</h3>
          <div class="value">${totalTransactions}</div>
        </div>
        <div class="stat-card">
          <h3>Total Revenue</h3>
          <div class="value">‚Çπ${totalRevenue.toFixed(2)}</div>
        </div>
        <div class="stat-card">
          <h3>Customer Savings</h3>
          <div class="value">‚Çπ${totalSavings.toFixed(2)}</div>
        </div>
        <div class="stat-card">
          <h3>Working Mode</h3>
          <div class="value">${workingMode}</div>
        </div>
      `;
    }

    function filterTable() {
      const searchTerm = document.getElementById('searchBox').value.toLowerCase();
      
      filteredTransactions = transactions.filter(t => {
        return (
          t.id.toLowerCase().includes(searchTerm) ||
          t.dateTime.toLowerCase().includes(searchTerm) ||
          t.originalAmount.toString().includes(searchTerm) ||
          t.finalAmount.toString().includes(searchTerm) ||
          t.mode.toLowerCase().includes(searchTerm)
        );
      });
      
      displayTransactions();
    }

    function refreshData() {
      document.getElementById('fileInput').click();
    }

    function exportToCSV() {
      if (transactions.length === 0) {
        alert('No transactions to export. Please load a transactions.json file first.');
        return;
      }

      const headers = ['Transaction ID', 'Date & Time', 'Original Amount', 'Discount %', 'Final Amount', 'Saved Amount', 'Mode'];
      const csvContent = [
        headers.join(','),
        ...transactions.map(t => [
          t.id,
          `"${t.dateTime}"`,
          t.originalAmount.toFixed(2),
          t.discountPercent,
          t.finalAmount.toFixed(2),
          t.savedAmount.toFixed(2),
          t.mode
        ].join(','))
      ].join('\n');

      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `transactions_export_${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>